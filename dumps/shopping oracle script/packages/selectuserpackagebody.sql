CREATE OR REPLACE PACKAGE BODY C##BIGDATA.SELECTUSER
IS
FUNCTION CHECKEMAIL (U_EMAIL IN LOGIN_TABLE_PRIMARY.EMAIL%TYPE) 
RETURN SYS_REFCURSOR
IS 
R_EMAIL SYS_REFCURSOR;
BEGIN
OPEN R_EMAIL FOR 
SELECT EMAIL FROM LOGIN_TABLE_PRIMARY WHERE UPPER(EMAIL)=UPPER(U_EMAIL);  
RETURN R_EMAIL;
END CHECKEMAIL;

FUNCTION CHECKLOGGIN(U_EMAIL IN LOGIN_TABLE_PRIMARY.EMAIL%TYPE,U_PASSWORD IN LOGIN_TABLE_PRIMARY.PASSWORD%TYPE)
RETURN SYS_REFCURSOR
IS
U_USER SYS_REFCURSOR;
BEGIN
OPEN U_USER FOR
SELECT P.ID,P.NAME,P.SURNAME,P.EMAIL,P.LOGIN_DATE,P.TASK FROM LOGIN_TABLE_PRIMARY P WHERE UPPER(P.EMAIL)=UPPER(U_EMAIL) AND P.PASSWORD=U_PASSWORD;
RETURN U_USER;
END CHECKLOGGIN;

FUNCTION BYIDFORBONUCE(U_EMAIL IN LOGIN_TABLE_PRIMARY.EMAIL%TYPE,U_PASSWORD IN LOGIN_TABLE_PRIMARY.PASSWORD%TYPE)
RETURN SYS_REFCURSOR
IS
U_USER SYS_REFCURSOR;
BEGIN
OPEN U_USER FOR
SELECT ID FROM LOGIN_TABLE_PRIMARY WHERE UPPER(EMAIL)=UPPER(U_EMAIL) AND PASSWORD=U_PASSWORD;
RETURN U_USER;
END BYIDFORBONUCE;

FUNCTION BYEMAIL(U_EMAIL IN LOGIN_TABLE_PRIMARY.EMAIL%TYPE)
RETURN SYS_REFCURSOR
IS
U_USER SYS_REFCURSOR;
BEGIN
OPEN U_USER FOR
SELECT ID FROM LOGIN_TABLE_PRIMARY WHERE UPPER(EMAIL)=UPPER(U_EMAIL);
RETURN U_USER;
END BYEMAIL;
PROCEDURE GETPRODUCTLIST(U_PRODUCT OUT SYS_REFCURSOR)
IS
BEGIN
OPEN U_PRODUCT FOR
SELECT PS.ID,PS.NAME,PS.PRICE,PS.BONUCE_VALUE,PS.IMPORTED_DATE,PP.PRODUCT_PATH FROM PRODUCTS_ON_SALE PS 
LEFT JOIN PRODUCT_PICTURE PP ON PS.ID=PP.PRODUCT_ID  WHERE PS.ACTIVE=1 ORDER BY PS.IMPORTED_DATE DESC;
END GETPRODUCTLIST;

PROCEDURE PRODUCTANDCATEGORY(U_CAT OUT SYS_REFCURSOR)
IS
BEGIN
OPEN U_CAT FOR
SELECT PS.ID,PS.NAME,PS.BONUCE_VALUE,PS.PRICE,PS.CATEGORY,D.ID D_ID,D.DICT_VALUE FROM PRODUCTS_ON_SALE PS  
INNER JOIN DICTIONARY D ON D.ID=PS.CATEGORY WHERE PS.ACTIVE=1;
END PRODUCTANDCATEGORY;
END SELECTUSER;
/
